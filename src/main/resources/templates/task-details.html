<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
            crossorigin="anonymous"
    />
    <title>Task details</title>
    <style>
        html {
            font-size: 15px;
        }
    </style>
</head>
<body>
<!-- Include _header.html -->
<th:block th:include="/_header"></th:block>
<main>
    <div class="container">
        <div class="col-12 py-4">
            <div class="d-flex justify-content-between mb-3">
                <h2>Task details</h2>
            </div>

            <div class="d-block text-center"
                 style="margin: 5px"
                 th:if="${errorMessage != null}"
                 th:text="${errorMessage}"
            ></div>
            <th:block th:each="error : ${FieldErrors}" th:if="${FieldErrors != null}">
                <div class="d-block text-center"
                     th:text="${error}"
                ></div>
            </th:block>
            <th:block th:each="error : ${GlobalErrors}"
                      th:if="${GlobalErrors != null && FieldErrors.isEmpty()}">
                <div class="d-block text-center"
                     th:text="${error}"
                ></div>
            </th:block>

            <form th:action="@{/board/{prName}/task/{taskId} (prName=${task.projectName}, taskId=${task.id})}"
                  method="post" id="editTaskForm" class="p-4" th:object="${task}">
                <div class="mb-3">
                    <label for="inputTitle" class="form-label">Title</label>
                    <input
                            type="text"
                            class="form-control"
                            id="inputTitle"
                            th:value="${task.name}"
                            name="name"
                            required
                    />
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="mb-3 row">
                            <label for="inputStatus" class="col-3 col-form-label">Task status</label>
                            <div class="col-9">
                                <select class="form-select" id="inputStatus" name="status">
                                    <th:block th:each="statusItem : ${taskStatusList}">
                                        <option th:text="${statusItem}"
                                                th:selected="${statusItem == task.status}"></option>
                                    </th:block>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="inputType" class="col-3 col-form-label">Task type</label>
                            <div class="col-9">
                                <select class="form-select" id="inputType" name="type">
                                    <th:block th:each="typeItem : ${taskTypeList}">
                                        <option th:text="${typeItem}"
                                                th:selected="${typeItem == task.type}"></option>
                                    </th:block>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="inputPriority" class="col-3 col-form-label">Priority</label>
                            <div class="col-9">
                                <select type="text" class="form-select" id="inputPriority" name="priority">
                                    <option th:each="i : ${#numbers.sequence(1, 5)}"
                                            th:value="${i}"
                                            th:text="${i}"
                                            th:selected="${i == task.priority}">
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="inputEstimated" class="col-3 col-form-label">Estimated Costs</label>
                            <div class="col-9">
                                <input
                                        type="text"
                                        class="form-control"
                                        id="inputEstimated"
                                        th:value="${task.estCosts}"
                                        name="estCosts"
                                />
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="inputActual" class="col-3 col-form-label">Actual Costs</label>
                            <div class="col-9">
                                <input
                                        type="text"
                                        class="form-control"
                                        id="inputActual"
                                        th:value="${task.actualCosts}"
                                        name="actualCosts"
                                />
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="inputRelease" class="col-3 col-form-label">Release</label>
                            <div class="col-9">
                                <select class="form-select" id="inputRelease" name="release">
                                    <th:block th:each="releaseItem : ${releaseList}">
                                        <option th:text="${releaseItem.name} + ' ' + '('
                                                    + ${#temporals.format(releaseItem.startDate, 'dd.MM.yyyy')}
                                                    + ' - ' + ${#temporals.format(releaseItem.finishDate, 'dd.MM.yyyy')+')'}"
                                                th:selected="${currentRelease == null ? false : releaseItem.name == currentRelease.name}"
                                                th:value="${releaseItem.id}"
                                        ></option>
                                    </th:block>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="mb-3 row">
                            <label for="inputStartDate" class="col-3 col-form-label"
                            >Start date</label
                            >
                            <div class="col-9">
                                <input
                                        type="datetime-local"
                                        class="form-control"
                                        id="inputStartDate"
                                        name="createDate"
                                        th:value="${task.createDate}"
                                />
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="inputEstimatedDate" class="col-3 col-form-label"
                            >Estimated end date</label
                            >
                            <div class="col-9">
                                <input
                                        type="datetime-local"
                                        class="form-control"
                                        id="inputEstimatedDate"
                                        name="dueDate"
                                        th:value="${task.dueDate}"
                                />
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label class="col-3 col-form-label" for="inputFinishDate"
                            >Actual end date</label
                            >
                            <div class="col-9">
                                <input
                                        type="datetime-local"
                                        class="form-control"
                                        id="inputFinishDate"
                                        name="finishDate"
                                        readonly
                                        th:value="${task.finishDate}"
                                />
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <label for="inputAssignee" class="col-3 col-form-label"
                            >Assignee</label
                            >
                            <div class="col-9">
                                <select class="form-select" id="inputAssignee" name="assigneeName">
                                    <th:block th:each="userItem : ${listUsers}">
                                        <option th:text="${userItem.firstName} + ' '
                                                    + ${userItem.lastName} + ' ' + ${userItem.userNumber}"
                                                th:selected="${(currentUser != null) ? userItem.firstName == currentUser.firstName
                                                and userItem.lastName == currentUser.lastName
                                                and userItem.userNumber == currentUser.userNumber : false}">
                                        </option>
                                    </th:block>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="inputDescription" class="form-label">Task description</label>
                        <textarea class="form-control" id="inputDescription" name="description"
                                  placeholder="Description..."
                                  rows="3" th:text="${task.description}"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="inputComments" class="form-label">Comments</label>
                        <textarea class="form-control" id="inputComments" name="comments" placeholder="Comments..."
                                  rows="3" th:text="${task.comments}"></textarea>
                    </div>
                    <div class="d-flex justify-content-between">
                        <div>
                            <button type="submit" class="btn btn-primary">Save and close</button>
                            <a th:href="@{/board/{prName}(prName=${task.projectName})}">
                                <button class="btn btn-secondary px-4" type="button">
                                    Cancel
                                </button>
                            </a>
                        </div>
                        <button class="btn btn-danger"
                                th:formaction="@{/board/{prName}/task/delete/{taskId} (prName=${task.projectName},
                        taskId=${task.id})}"
                                type="submit">
                            Delete task
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</main>
</body>
</html>
